<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>MTHD의 오늘의 메뉴 추천!</title>
  <style>
    html, body {
      min-height: 100vh;
      margin: 0; padding: 0;
      background: radial-gradient(circle at 60% 20%, #f8f8ff 0%, #f3f3fc 60%, #ffe8fa 100%);
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      box-sizing: border-box;
      overflow-x: hidden;
      overflow-y: auto;
    }
    body {
      width: 100vw; min-width: 320px;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    h1 {
      margin: 32px 0 14px 0;
      font-size: 3.1em;
      color: #940059;
      letter-spacing: 2.5px;
      font-weight: 900;
      text-align: center;
      line-height: 1.13;
      text-shadow: 0 5px 25px #f8b1f74f, 0 2px 6px #c098bb3a;
      word-break: keep-all;
      user-select: none;
      z-index: 30;
      position: relative;
    }
    .setting {
      width: 340px; max-width: 96vw;
      background: #fff8;
      border-radius: 13px;
      box-shadow: 0 2px 16px #e6b1e955;
      margin: 12px 0 3px 0; padding: 17px 20px 15px 20px;
      display: flex; flex-direction: column; align-items: stretch; gap: 12px;
      position: relative; z-index: 15;
    }
    .setting label {
      font-size: 1.08em; color: #823469; font-weight: bold;
      margin-bottom: 7px;
      letter-spacing: 1.4px;
    }
    .setting textarea {
      width: 100%; min-height: 83px; padding: 8px 10px;
      font-size: 1.07em; border-radius: 9px; border: 2px solid #dea1e5;
      resize: vertical; outline: none;
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      background: #f8f6ff;
      box-shadow: 0 1px 4px #ffe4f911;
    }
    .setting button {
      align-self: flex-end;
      font-size: 1.09em; color: #fff;
      background: linear-gradient(90deg, #df65a5 70%, #a06be1 100%);
      border: none; border-radius: 7px; padding: 7px 18px 6px 18px;
      font-weight: bold; cursor: pointer; margin-top: 6px;
      box-shadow: 0 3px 12px #efb5c533;
      letter-spacing: 0.6px;
      transition: background .15s;
    }
    .setting button:active {background: linear-gradient(90deg, #b14389 70%, #544ba9 100%);}
    .notice {
      color: #8a2962; font-size: 0.97em; margin-bottom: 2px; text-align: right;
    }
    .word-cloud-bg {
      pointer-events: none;
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      z-index: 2;
      overflow: hidden;
    }
    .cloud-word {
      position: absolute;
      font-size: calc(18px + 2.8vw);
      font-weight: 700;
      color: #c39ff84a;
      opacity: 0.34;
      letter-spacing: 2px;
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      filter: blur(0.5px);
      /* pointer-events: none; */
      will-change: transform;
      transition: filter 0.16s;
      user-select: none;
      white-space: pre;
    }
    .cloud-word.near {
      opacity: 0.68;
      filter: blur(0.2px) drop-shadow(0 2px 10px #ffecfc16);
      color: #a47fcf94;
      z-index: 6;
      transition: filter .1s;
    }

    .gacha-area {
      position: relative;
      width: 365px; max-width: 97vw;
      height: 580px; max-height: 92vh;
      margin: 20px 0 16px 0;
      min-width: 200px;
      z-index: 10;
    }
    .gacha-machine {
      position: absolute;
      left: 50%; top: 0; transform: translateX(-50%);
      width: 340px; height: 520px;
      z-index: 10;
      user-select: none;
      pointer-events: none;
    }
    .gacha-body{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:270px;height:170px;background:linear-gradient(0deg,#d82d47 60%,#a11836 100%);border:6px solid #c2c2c2;border-radius:15px 15px 30px 30px/25px 25px 25px 38px;box-shadow:0 10px 30px #d3567355;z-index:2;}
    .gacha-window{position:absolute;top:0;left:50%;transform:translateX(-50%);width:270px;height:285px;background:linear-gradient(180deg,#fff7ff 60%,#e7f0ff 100%);border:6px solid #c2c2c2;border-bottom:none;border-radius:23px 23px 68px 68px/38px 38px 100px 100px;overflow:hidden;z-index:3;display:flex;flex-wrap:wrap;align-items:flex-end;justify-content:center;padding-bottom:16px;}
    .capsule{width:44px;height:43px;margin:2px;margin-top:10px;border-radius:50%;background:radial-gradient(circle at 20px 15px,var(--cap1,#fae),var(--cap2,#cbf));border:2px solid #8882aa;box-shadow:0 2px 10px #c58ca644;}
    .capsule:nth-child(1){--cap1:#fec;--cap2:#fcc;}
    .capsule:nth-child(2){--cap1:#9fd;--cap2:#3df;}
    .capsule:nth-child(3){--cap1:#cbe;--cap2:#f9f;}
    .capsule:nth-child(4){--cap1:#ff5;--cap2:#fc0;}
    .capsule:nth-child(5){--cap1:#9ff;--cap2:#7cf;}
    .capsule:nth-child(6){--cap1:#fda;--cap2:#fd8;}
    .capsule:nth-child(7){--cap1:#fdc;--cap2:#fac;}
    .capsule:nth-child(8){--cap1:#acf;--cap2:#bfe;}
    .capsule:nth-child(9){--cap1:#f8f;--cap2:#c8f;}
    .gacha-lever {
      position: absolute;
      left: 50%; bottom: 115px;
      transform: translateX(-50%);
      z-index: 15;
      width: 60px; height: 60px;
      border-radius: 50%;
      background: linear-gradient(160deg,#eee,#bbb 70%);
      border: 3.2px solid #888;
      box-shadow: 0 4px 10px #ad2d5319;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: box-shadow .12s;
      pointer-events: auto;
    }
    .gacha-lever:active,.lever-spin{box-shadow:0 2px 24px #83005a90;animation:leverAnime .69s cubic-bezier(.61,2,.27,1) 1;}
    @keyframes leverAnime{0%{transform:translateX(-50%) rotate(0);}15%{transform:translateX(-50%) rotate(-35deg);}53%{transform:translateX(-50%) rotate(50deg);}100%{transform:translateX(-50%) rotate(0);}}
    .lever-dot{width:36px;height:36px;background:radial-gradient(circle at 75% 22%,#f25 70%,#8b1 100%);border-radius:50%;border:2px solid #ab2828;box-shadow:0 1px 6px #e8939b;}
    .gacha-door{position:absolute;left:72%;bottom:12px;width:44px;height:38px;background:linear-gradient(140deg,#fff 80%,#eee 95%);border:2.5px solid #acacac;border-radius:11px 12px 7px 12px/15px 25px 24px 17px;box-shadow:0 0 8px #bbb6;z-index:30;}
    .roll-capsule {
      --ball1: #ffadad; --ball2: #ffd6a5;
      position: absolute; left: 73.7%; bottom: 105px;
      width: 50px; height: 50px; z-index: 210;
      pointer-events: none;
      border-radius: 50%; background: radial-gradient(circle at 14px 12px, var(--ball1), var(--ball2));
      border: 3px solid #ae93b7;
      box-shadow: 0 2px 10px #e4568348;
      opacity: 0;
      display: flex;align-items: center; justify-content: center; transition: none;
    }
    .roll-capsule.rolling {
      opacity: 1;
      animation: roll-from-window 0.9s cubic-bezier(.4,2.2,.5,1.02) 0s 1 forwards;
    }
    @keyframes roll-from-window {
      0% { left: 52%; bottom: 250px; transform: scale(.78) rotate(-30deg);}
      60% { left: 73.5%; bottom: 128px; transform: scale(1.2) rotate(20deg);}
      90% { left: 73.7%; bottom: 118px; transform: scale(1) rotate(1deg);}
      100%{ left: 73.7%; bottom: 105px; transform: scale(1) rotate(0);}
    }
    .roll-capsule.toward-center {
      animation: move-to-center 0.8s cubic-bezier(.39,2,.4,1.08) 0s 1 forwards;
    }
    @keyframes move-to-center {
      0% { left: 73.7%; bottom: 105px; width: 50px; height: 50px;}
      100% { left: 50%; bottom: 55%; width: 140px; height: 140px; transform: translate(-50%,50%) rotate(0);}
    }
    .capsule-hinge {
      width: 100%; height: 100%;
      position: absolute; left: 0; top: 0;
      z-index: 30;
      pointer-events: none;
    }
    .cap-top {
      width: 100%; height: 50%;
      background: radial-gradient(circle at 35% 32%, #fff4f7 60%, #f1c0e8 100%);
      border-bottom: 3px solid #ae93b7;
      border-radius: 110px 110px 90px 90px/70px 75px 40px 40px;
      position: absolute; left: 0; top: 0;
      transition: transform 0.7s cubic-bezier(.88,2.23,.40,1);
      z-index: 38;
    }
    .open .cap-top {
      transform: rotate(-70deg) translate(-45px,-85px);
      box-shadow: 0 8px 22px #df8eeeca;
    }
    .cap-bottom {
      width: 100%; height: 50%;
      background: radial-gradient(circle at 25% 30%, #f1c0e8 60%, #fff4f7 100%);
      border-top: 3px solid #ae93b7;
      border-radius: 0 0 70px 70px/0 0 60px 60px;
      position: absolute; left: 0; bottom: 0;
      z-index: 39;
    }
    .super-result {
      position: fixed;
      left: 50%; top: 53%;
      transform: translate(-50%, -48%) scale(1);
      font-size: clamp(2.9em,8vw,6.5em);
      color: #fff;
      font-weight: 900;
      text-shadow: 0 7px 28px #d06aff88, 0 3px 20px #c2afffa0, 0 2px 13px #a354e044;
      letter-spacing: 2.2px;
      line-height: 1.1;
      pointer-events: none;
      opacity: 0;
      z-index: 9999;
      white-space: pre-line;
      transition: opacity .25s, filter 0.1s;
      filter: drop-shadow(0 8px 32px #7947e188) brightness(1.04);
      user-select: none;
    }
    .super-result.visible {
      opacity: 1;
      animation: pop-fade-sup 0.72s cubic-bezier(.4,2,0.59,1.01) .08s 1 backwards;
    }
    @keyframes pop-fade-sup {
      0% {filter:blur(18px) drop-shadow(0 0 0 #fff); opacity: 0;}
      48% {opacity:1;filter:blur(2px) drop-shadow(0 7px 28px #d06aff88);}
      87% {transform:translate(-50%,-54%) scale(1.13);}
      100%{filter:blur(0) drop-shadow(0 7px 28px #d06aff88);}
    }
    .confetti {
      position: fixed;
      width: 12px; height: 22px;
      border-radius: 5px;
      z-index: 11000;
      opacity: 0.94;
      pointer-events: none;
      mix-blend-mode: multiply;
    }
    @media (max-width:540px) {
      .gacha-area {height: 55vw;min-height:340px;}
      .gacha-machine { width:99vw; min-width:0; }
      .super-result {font-size: 2.2em;}
    }
    .bandai {
      position: fixed;
      right: 12px; bottom: 8px;
      font-family: 'Arial Black', Arial, sans-serif;
      color: #fff; background: #cf234a;
      padding: 3px 19px 3px 16px;
      border-radius: 15px 9px 15px 20px/20px;
      font-size: 1.14em;
      letter-spacing: 0.19em;
      z-index: 10000;
      box-shadow: 0 4px 18px #a8333a2a;
      opacity: 0.93;
      font-weight: 900;
      user-select: none;
    }
  </style>
  <body>
    <div class="word-cloud-bg" id="cloudBg"></div>
    <h1>MTHD의<br>오늘의 메뉴 추천 !</h1>
    <div class="setting">
      <label for="itemlist">뽑기 리스트 (한 줄에 하나씩 입력):</label>
      <textarea id="itemlist" placeholder="예시&#10;쌀국수&#10;짬뽕&짜장"></textarea>
      <button id="saveBtn">저장하기</button>
      <div class="notice">저장하면 사이트를 다시 열어도 유지돼요!</div>
    </div>
    <div class="gacha-area" id="gachaArea">
      <div class="gacha-machine">
        <div class="gacha-window">
          <div class="capsule"></div><div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div>
        </div>
        <div class="gacha-lever" id="lever" title="손잡이를 돌려 뽑기!">
          <div class="lever-dot"></div>
        </div>
        <div class="gacha-body"></div>
        <div class="gacha-door"></div>
      </div>
      <div class="roll-capsule" id="rollCapsule" style="display:none;">
        <div class="capsule-hinge">
          <div class="cap-top" id="capTop"></div>
          <div class="cap-bottom"></div>
        </div>
      </div>
    </div>
    <div class="super-result" id="superResult"></div>
    <div class="bandai">BANDAI</div>
    <script>
      // ---- 뽑기 리스트 저장 & 복원 ----
      const STORAGE_KEY = "__gacha_items_v3__";
      const textarea = document.getElementById('itemlist');
      const saveBtn = document.getElementById('saveBtn');
      const cloudBg = document.getElementById('cloudBg');
      function saveList() {
        localStorage.setItem(STORAGE_KEY, textarea.value);
      }
      function loadList() {
        const saved = localStorage.getItem(STORAGE_KEY);
        textarea.value = saved ? saved : "";
      }
      saveBtn.addEventListener('click', () => {
        saveList();
        saveBtn.textContent = '저장됨!';
        setTimeout(() => { saveBtn.textContent = '저장하기'; }, 1000);
        renderCloudWords();
      });
      window.addEventListener('DOMContentLoaded', () => {
        loadList();
        renderCloudWords();
      });

      // ---- 배경 단어 클라우드 ----
      function renderCloudWords() {
        cloudBg.innerHTML = "";
        const raw = textarea.value.split('\n').map(t=>t.trim()).filter(Boolean);
        if (!raw.length) return;
        const W = window.innerWidth, H = window.innerHeight;
        let reps = Math.max(13, Math.floor(W*H/55000));
        let used = [];
        for (let r=0; r<reps; r++) for (let i=0; i<raw.length; i++)
          used.push(raw[i]);
        // 단어 위치/크기/회전 랜덤 배치
        used.sort(() => Math.random() - .5);
        used = used.slice(0,Math.min(38+Math.floor(W/60),used.length));
        used.forEach(w => {
          let span = document.createElement('span');
          span.textContent = w;
          span.className = 'cloud-word';
          let px = Math.random(), py = Math.random();
          span.style.left = `calc(${(px*96)}vw)`;
          span.style.top = `calc(${Math.pow(py,1.3)*92}vh)`;
          let a = Math.round((Math.random()-0.5)*36);
          span.style.transform += ` rotate(${a}deg)`;
          cloudBg.appendChild(span);
        });
      }
      // 단어 클라우드 커서 인터랙션
      window.addEventListener('mousemove', e => {
        const words = document.querySelectorAll('.cloud-word');
        const mx = e.clientX, my = e.clientY;
        words.forEach(w=>{
          let rect = w.getBoundingClientRect(),
              wx = rect.left+rect.width/2, wy = rect.top+rect.height/2;
          let dx = wx-mx, dy = wy-my;
          let d = Math.sqrt(dx*dx + dy*dy);
          if (d < 130) {
            w.classList.add('near');
            let rep = Math.max(0, 130 - d);
            w.style.transform += ` translate(${dx/40*rep}px,${dy/40*rep}px)`;
          } else {
            w.classList.remove('near');
            w.style.transform = w.style.transform.replace(/translate\([^\)]*\)/g,'');
          }
        });
      });

      textarea.addEventListener('input', renderCloudWords);

      // ---- 가챠 본체 애니메이션/컨페티/결과 ----
      const lever = document.getElementById('lever');
      const rollCapsule = document.getElementById('rollCapsule');
      const capTop = document.getElementById('capTop');
      const superResult = document.getElementById('superResult');
      let isRolling = false;

      function confettiBurst(centerX, centerY) {
        const colors = [
          "#fff275","#ff6150","#6469f9","#3ad29f","#fec0fa",
          "#a1f7ff","#feaeae","#5bf45b","#ffdca6","#c17aff"
        ];
        let confs = [];
        for (let i = 0; i < 48; i++) {
          let conf = document.createElement('div');
          conf.className = 'confetti';
          let angle = Math.random() * Math.PI * 2;
          let dist = 80 + Math.random() * 120;
          let s = 0.8 + Math.random()*1.1;
          conf.style.background = colors[Math.floor(Math.random()*colors.length)];
          conf.style.left = (centerX-6) + "px";
          conf.style.top = (centerY-12) + "px";
          conf.style.transform = `rotate(${Math.random()*360}deg) scale(${s})`;
          conf.animate([
            { opacity: 0.96, transform: `translate(0,0) scale(${s}) rotate(${Math.random()*360}deg)` },
            { opacity: 1, offset: 0.13 },
            { opacity: 0.85,
              transform: `translate(${Math.cos(angle)*dist}px,${Math.sin(angle)*dist}px) scale(${s}) rotate(${Math.random()>.5?240:390}deg)` },
            { opacity: 0,
              transform: `translate(${Math.cos(angle)*dist*1.2}px,${Math.sin(angle)*dist*1.15}px) scale(${s}) rotate(${Math.random()>.5?120:520}deg)` }
          ],{ duration: 920 + Math.random()*600, easing: 'cubic-bezier(.45,.8,.18,1)', fill:'forwards' });
          document.body.appendChild(conf);
          confs.push(conf);
        }
        setTimeout(()=>confs.forEach(c=>c.remove()),2400);
      }

      lever.addEventListener('click', () => {
        if (isRolling) return; // 중복방지
        const items = textarea.value.split('\n').map(e=>e.trim()).filter(e=>e.length>0);
        if (items.length < 1) {
          alert("뽑기 리스트를 입력 후 저장해주세요!");
          return;
        }
        isRolling = true;

        lever.classList.add('lever-spin');
        setTimeout(() => lever.classList.remove('lever-spin'), 700);

        rollCapsule.style.display = "none";
        rollCapsule.className = "roll-capsule";
        capTop.className = "cap-top";
        superResult.classList.remove("visible");
        superResult.textContent = "";

        // 결과와 색
        rollCapsule.style.display = "flex";
        setTimeout(()=>{
          rollCapsule.className = "roll-capsule rolling";
          setTimeout(()=>{
            rollCapsule.className += " toward-center";
            setTimeout(()=>{
              rollCapsule.className += " open";
              capTop.classList.add('open');
              // 캡슐 위치에서 컨페티! (정가운데로 맞춰줌)
              let rect = rollCapsule.getBoundingClientRect();
              let centerX = rect.left + rect.width/2 + window.scrollX;
              let centerY = rect.top + rect.height*0.65 + window.scrollY;
              superResult.style.opacity = 0;
              superResult.textContent = resultTxt;
              setTimeout(()=>{
                superResult.classList.add("visible");
                superResult.style.opacity = 1;
                confettiBurst(centerX, centerY);

                // 2초후 초기화
                setTimeout(()=>{
                  rollCapsule.style.display="none";
                  superResult.classList.remove("visible");
                  rollCapsule.className = "roll-capsule";
                  capTop.className = "cap-top";
                  isRolling = false;
                },1800);

              },220); // 결과+컨페티 팡 delay
            },820); // 중앙 이동 후 열림
          },820); // 출구->중앙 이동
        },130); // 레버 후 굴러나오게 딜레이
      });

      // 창 크기 바뀌면 배경 단어 재배치
      window.addEventListener('resize', renderCloudWords);
    </script>
  </body>
</html>
