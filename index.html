<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>MTHD의 오늘의 메뉴 추천!</title>
  <style>
    html, body {
      min-height: 100vh;
      margin: 0; padding: 0;
      background: radial-gradient(circle at 60% 20%, #f8f8ff 0%, #f3f3fc 60%, #ffe8fa 100%);
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      box-sizing: border-box;
      overflow-x: hidden;
      overflow-y: auto;
    }
    body {
      width: 100vw; min-width: 320px;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    }
    h1 {
      margin: 32px 0 14px 0;
      font-size: 3.1em;
      color: #940059;
      letter-spacing: 2.5px;
      font-weight: 900;
      text-align: center;
      line-height: 1.13;
      text-shadow: 0 5px 25px #f8b1f74f, 0 2px 6px #c098bb3a;
      word-break: keep-all;
      user-select: none;
    }
    .setting {
      width: 340px; max-width: 96vw;
      background: #fff8;
      border-radius: 13px;
      box-shadow: 0 2px 16px #e6b1e955;
      margin: 12px 0 3px 0; padding: 17px 20px 15px 20px;
      display: flex; flex-direction: column; align-items: stretch; gap: 12px;
    }
    .setting label {
      font-size: 1.08em; color: #823469; font-weight: bold;
      margin-bottom: 7px;
      letter-spacing: 1.4px;
    }
    .setting textarea {
      width: 100%; min-height: 83px; padding: 8px 10px;
      font-size: 1.07em; border-radius: 9px; border: 2px solid #dea1e5;
      resize: vertical; outline: none;
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      background: #f8f6ff;
      box-shadow: 0 1px 4px #ffe4f911;
    }
    .setting button {
      align-self: flex-end;
      font-size: 1.09em; color: #fff;
      background: linear-gradient(90deg, #df65a5 70%, #a06be1 100%);
      border: none; border-radius: 7px; padding: 7px 18px 6px 18px;
      font-weight: bold; cursor: pointer; margin-top: 6px;
      box-shadow: 0 3px 12px #efb5c533;
      letter-spacing: 0.6px;
      transition: background .15s;
    }
    .setting button:active {background: linear-gradient(90deg, #b14389 70%, #544ba9 100%);}
    .notice {
      color: #8a2962; font-size: 0.97em; margin-bottom: 2px; text-align: right;
    }

    /* --- GACHA MACHINE --- */
    .gacha-area {
      position: relative;
      width: 365px; max-width: 97vw;
      height: 580px; max-height: 92vh;
      margin: 20px 0 16px 0;
      min-width: 200px;
      z-index: 1;
    }
    .gacha-machine {
      position: absolute;
      left: 50%; top: 0; transform: translateX(-50%);
      width: 340px; height: 520px;
      z-index: 10;
      pointer-events: none;
      user-select: none;
    }
    .gacha-body{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:270px;height:170px;background:linear-gradient(0deg,#d82d47 60%,#a11836 100%);border:6px solid #c2c2c2;border-radius:15px 15px 30px 30px/25px 25px 25px 38px;box-shadow:0 10px 30px #d3567355;z-index:2;}
    .gacha-window{position:absolute;top:0;left:50%;transform:translateX(-50%);width:270px;height:285px;background:linear-gradient(180deg,#fff7ff 60%,#e7f0ff 100%);border:6px solid #c2c2c2;border-bottom:none;border-radius:23px 23px 68px 68px/38px 38px 100px 100px;overflow:hidden;z-index:3;display:flex;flex-wrap:wrap;align-items:flex-end;justify-content:center;padding-bottom:16px;}
    .capsule{width:44px;height:43px;margin:2px;margin-top:10px;border-radius:50%;background:radial-gradient(circle at 20px 15px,var(--cap1,#fae),var(--cap2,#cbf));border:2px solid #8882aa;box-shadow:0 2px 10px #c58ca644;}
    .capsule:nth-child(1){--cap1:#fec;--cap2:#fcc;}
    .capsule:nth-child(2){--cap1:#9fd;--cap2:#3df;}
    .capsule:nth-child(3){--cap1:#cbe;--cap2:#f9f;}
    .capsule:nth-child(4){--cap1:#ff5;--cap2:#fc0;}
    .capsule:nth-child(5){--cap1:#9ff;--cap2:#7cf;}
    .capsule:nth-child(6){--cap1:#fda;--cap2:#fd8;}
    .capsule:nth-child(7){--cap1:#fdc;--cap2:#fac;}
    .capsule:nth-child(8){--cap1:#acf;--cap2:#bfe;}
    .capsule:nth-child(9){--cap1:#f8f;--cap2:#c8f;}
    .gacha-lever{position:absolute;left:50%;bottom:115px;transform:translateX(-50%);z-index:15;width:60px;height:60px;border-radius:50%;background:linear-gradient(160deg,#eee,#bbb 70%);border:3.2px solid #888;box-shadow:0 4px 10px #ad2d5319;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:box-shadow .12s;}
    .gacha-lever:active,.lever-spin{box-shadow:0 2px 24px #83005a90;animation:leverAnime .69s cubic-bezier(.61,2,.27,1) 1;}
    @keyframes leverAnime{0%{transform:translateX(-50%) rotate(0);}15%{transform:translateX(-50%) rotate(-35deg);}53%{transform:translateX(-50%) rotate(50deg);}100%{transform:translateX(-50%) rotate(0);}}
    .lever-dot{width:36px;height:36px;background:radial-gradient(circle at 75% 22%,#f25 70%,#8b1 100%);border-radius:50%;border:2px solid #ab2828;box-shadow:0 1px 6px #e8939b;}
    .gacha-door{position:absolute;left:72%;bottom:12px;width:44px;height:38px;background:linear-gradient(140deg,#fff 80%,#eee 95%);border:2.5px solid #acacac;border-radius:11px 12px 7px 12px/15px 25px 24px 17px;box-shadow:0 0 8px #bbb6;z-index:30;}
    .roll-capsule {
      --ball1: #ffadad; --ball2: #ffd6a5;
      position: absolute; left: 73.7%; bottom: 105px;
      width: 50px; height: 50px; z-index: 200; pointer-events: none;
      border-radius: 50%; background: radial-gradient: 50px;
      border: 3px solid #ae93b7;
      box-shadow: 0 2px 10px #e4568348;
      opacity: 0;
      display: flex;
      align-items: center; justify-content: center;
      transition: none;
    }
    .roll-capsule.rolling {
      opacity: 1;
      animation: roll-from-window 0.9s cubic-bezier(.4,2.2,.5,1.02) 0s 1 forwards;
    }
    @keyframes roll-from-window {
      0% { left: 52%; bottom: 250px; transform: scale(.78) rotate(-30deg);}
      60% { left: 73.5%; bottom: 128px; transform: scale(1.2) rotate(20deg);}
      90% { left: 73.7%; bottom: 118px; transform: scale(1) rotate(1deg);}
      100%{ left: 73.7%; bottom: 105px; transform: scale(1) rotate(0);}
    }
    .roll-capsule.toward-center {
      animation: move-to-center 0.8s cubic-bezier(.39,2,.4,1.08) 0s 1 forwards;
    }
    @keyframes move-to-center {
      0% { left: 73.7%; bottom: 105px; width: 50px; height: 50px;}
      100% { left: 50%; bottom: 55%; width: 140px; height: 140px; transform: translate(-50%,50%) rotate(0);}
    }
    .capsule-hinge {
      width: 100%; height: 100%;
      position: absolute; left: 0; top: 0;
      z-index: 30;
      pointer-events: none;
    }
    .cap-top {
      width: 100%; height: 50%;
      background: radial-gradient(circle at 35% 32%, #fff4f7 60%, #f1c0e8 100%);
      border-bottom: 3px solid #ae93b7;
      border-radius: 110px 110px 90px 90px/70px 75px 40px 40px;
      position: absolute; left: 0; top: 0;
      transition: transform 0.7s cubic-bezier(.88,2.23,.40,1);
      z-index: 38;
    }
    .open .cap-top {
      transform: rotate(-70deg) translate(-45px,-85px);
      box-shadow: 0 8px 22px #df8eeeca;
    }
    .cap-bottom {
      width: 100%; height: 50%;
      background: radial-gradient(circle at 25% 30%, #f1c0e8 60%, #fff4f7 100%);
      border-top: 3px solid #ae93b7;
      border-radius: 0 0 70px 70px/0 0 60px 60px;
      position: absolute; left: 0; bottom: 0;
      z-index: 39;
    }
    .result-label {
      position: absolute;
      left: 50%; bottom: 44%;
      transform: translate(-50%, 0) scale(.75);
      font-size: 2.4em; font-weight: bold; color: #a32960;
      letter-spacing: 1.2px; text-align: center;
      border-radius: 18px; padding: 24px 32px 18px 32px;
      background: #fffbe9;
      box-shadow: 0 10px 30px #ef8ff84d;
      opacity: 0; z-index: 50;
      border: 2px solid #fae5ff;
      line-height: 1.4;
      word-break: keep-all;
      white-space: pre-line;
      user-select: none;
    }
    .result-label.visible {
      animation: pop-label-fade 0.55s cubic-bezier(.4,2,0.65,1.01) .12s 1 backwards;
      opacity: 1;
      transform: translate(-50%, 0) scale(1.12);
    }
    @keyframes pop-label-fade {
      0% {opacity: 0; transform: translate(-50%,40px) scale(.32);}
      80% {opacity:1;  transform: translate(-50%,-28px) scale(1.21);}
      100%{opacity:1;  transform: translate(-50%,0) scale(1.12);}
    }
    .pang-pop {
      position: absolute;
      left: 50%; top: 43%;
      transform: translate(-50%, -45%) scale(.7);
      font-size: 3.1em; color: #ff4e69; font-weight: bold;
      text-shadow: 1.5px 2px 0 #fff0cc, 3px 4px 12px #b1554045;
      opacity: 0; pointer-events: none;
      z-index: 60;
      letter-spacing: 2.5px;
      user-select: none;
    }
    .pang-pop.visible {
      opacity: 1;
      animation: pangpopmake 0.57s cubic-bezier(.42,2.1,.62,.93) .13s 1 backwards;
      transform: translate(-50%, -45%) scale(1.12);
    }
    @keyframes pangpopmake {
      0% { opacity: 0; scale: 0.1;}
      65% { opacity: 1; scale: 1.45;}
      100% { opacity: 1; scale: 1.12;}
    }
    .confetti {
      position: absolute;
      width: 12px; height: 22px;
      border-radius: 5px;
      z-index: 1100;
      opacity: 0.94;
      pointer-events: none;
      mix-blend-mode: multiply;
    }
    @media (max-width:540px) {
      .gacha-area {height: 55vw;min-height:340px;}
      .gacha-machine { width:99vw; min-width:0; }
    }
    /* 하단 BANDAI */
    .bandai {
      position: fixed;
      right: 12px; bottom: 8px;
      font-family: 'Arial Black', Arial, sans-serif;
      color: #fff; background: #cf234a;
      padding: 3px 19px 3px 16px;
      border-radius: 15px 9px 15px 20px/20px;
      font-size: 1.14em;
      letter-spacing: 0.19em;
      z-index: 10000;
      box-shadow: 0 4px 18px #a8333a2a;
      opacity: 0.93;
      font-weight: 900;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>MTHD의<br>오늘의 메뉴 추천 !</h1>
  <div class="setting">
    <label for="itemlist">뽑기 리스트 (한 줄에 하나씩 입력):</label>
    <textarea id="itemlist" placeholder="예시&#10;쌀국수&#10;짬뽕&짜장"></textarea>
    <button id="saveBtn">저장하기</button>
    <div class="notice">저장하면 사이트를 다시 열어도 유지돼요!</div>
  </div>
  <div class="gacha-area" id="gachaArea">
    <div class="gacha-machine">
      <div class="gacha-window">
        <div class="capsule"></div><div class="capsule"></div><div class="capsule"></div>
        <div class="capsule"></div><div class="capsule"></div><div class="capsule"></div>
        <div class="capsule"></div><div class="capsule"></div><div class="capsule"></div>
        <div class="capsule"></div><div class="capsule"></div>
      </div>
      <div class="gacha-lever" id="lever" title="손잡이를 돌려 뽑기!">
        <div class="lever-dot"></div>
      </div>
      <div class="gacha-body"></div>
      <div class="gacha-door"></div>
    </div>
    <!-- 굴러나오는/중앙으로 가는 캡슐 -->
    <div class="roll-capsule" id="rollCapsule" style="display:none;">
      <div class="capsule-hinge">
        <div class="cap-top" id="capTop"></div>
        <div class="cap-bottom"></div>
      </div>
    </div>
    <!-- 결과 텍스트 -->
    <div class="result-label" id="resultLabel"></div>
    <div class="pang-pop" id="pangPop">팡!</div>
  </div>
  <div class="bandai">BANDAI</div>
  <script>
    // --- 저장/불러오기 ---
    const STORAGE_KEY = "__gacha_items_v2__";
    const textarea = document.getElementById('itemlist');
    const saveBtn = document.getElementById('saveBtn');
    function saveList() {
      localStorage.setItem(STORAGE_KEY, textarea.value);
    }
    function loadList() {
      const saved = localStorage.getItem(STORAGE_KEY);
      textarea.value = saved ? saved : "";
    }
    saveBtn.addEventListener('click', () => {
      saveList();
      saveBtn.textContent = '저장됨!';
      setTimeout(() => { saveBtn.textContent = '저장하기'; }, 1000);
    });
    window.addEventListener('DOMContentLoaded', loadList);

    // --- 가챠 애니메이션 & 결과 & 컨페티 함수 ---
    const lever = document.getElementById('lever');
    const rollCapsule = document.getElementById('rollCapsule');
    const capTop = document.getElementById('capTop');
    const resultLabel = document.getElementById('resultLabel');
    const pangPop = document.getElementById('pangPop');
    const gachaArea = document.getElementById('gachaArea');
    let isRolling = false;

    function confettiBurst(centerX, centerY) {
      const colors = [
        "#fff275","#ff6150","#6469f9","#3ad29f","#fec0fa",
        "#a1f7ff","#feaeae","#5bf45b","#ffdca6","#c17aff"
      ];
      let confs = [];
      for (let i = 0; i < 42; i++) {
        let conf = document.createElement('div');
        conf.classList.add('confetti');
        let angle = Math.random() * Math.PI * 2;
        let dist = 80 + Math.random()*120;
        let s = 0.8 + Math.random()*1.15;
        conf.style.background = colors[Math.floor(Math.random()*colors.length)];
        conf.style.left = (centerX-6) + "px";
        conf.style.top = (centerY-12) + "px";
        conf.style.transform = `rotate(${Math.random()*360}deg) scale(${s})`;
        conf.animate([
          { 
            opacity: 0.93,
            transform: `translate(0,0) scale(${s}) rotate(${Math.random()*360}deg)`,
          },
          { 
            opacity: 1,
            offset: 0.14
          },
          {
            opacity: 0.85,
            transform: `translate(${Math.cos(angle)*dist}px,${Math.sin(angle)*dist}px) scale(${s}) rotate(${Math.random()<.5?240:390}deg)`
          },
          {
            opacity: 0,
            transform: `translate(${Math.cos(angle)*dist*1.25}px,${Math.sin(angle)*dist*1.15}px) scale(${s}) rotate(${Math.random()<.5?210:540}deg)`
          }
        ],{
          duration: 820 + Math.random()*580,
          easing: 'cubic-bezier(.45,.8,.18,1)',
          fill: 'forwards'
        });
        gachaArea.appendChild(conf);
        confs.push(conf);
      }
      setTimeout(() => confs.forEach(c=>c.remove()), 2200);
    }

    lever.addEventListener('click', () => {
      if (isRolling) return;
      // 리스트 읽기
      const items = textarea.value.split('\n').map(e => e.trim()).filter(e => e.length > 0);
      if (items.length < 1) {
        alert("뽑기 리스트를 입력 후 저장해주세요!");
        return;
      }
      isRolling = true;
      lever.classList.add('lever-spin');
      setTimeout(() => lever.classList.remove('lever-spin'), 700);

      // 기존 효과 제거(숨김)
      rollCapsule.style.display = "none";
      rollCapsule.className = "roll-capsule";
      capTop.className = "cap-top";
      resultLabel.textContent = "";
      resultLabel.classList.remove("visible");
      pangPop.classList.remove("visible");

      // 뽑힐 항목 + 랜덤 캡슐 컬러 선정
      const idx = Math.floor(Math.random() * items.length);
      const resultTxt = items[idx];
      let ballcolors = [
        ["#ffadad","#ffd6a5"],["#caffbf","#9bf6ff"],
        ["#bdb2ff","#ffc6ff"],["#fcf6bd","#fdffb6"],
        ["#a0c4ff","#bdb2ff"],["#f1c0e8","#e2f0cb"]
      ];
      let bc = ballcolors[Math.floor(Math.random()*ballcolors.length)];

      // 굴러나오는 캡슐 준비
      rollCapsule.style.setProperty('--ball1', bc[0]);
      rollCapsule.style.setProperty('--ball2', bc[1]);
      rollCapsule.style.display = "flex";
      // 굴러오기 애니메이션
      setTimeout(()=>{
        rollCapsule.className = "roll-capsule rolling";
        // 출구로 도착 후 중앙 큰 캡슐로 변신
        setTimeout(()=>{
          rollCapsule.className += " toward-center";
          // 중앙에서 열리며 결과 팡! 컨페티
          setTimeout(()=>{
            rollCapsule.className += " open";
            capTop.classList.add('open');
            // 중앙좌표(컨페티용)
            let rect = rollCapsule.getBoundingClientRect();
            let centerX = rect.left + rect.width/2 + window.scrollX;
            let centerY = rect.top + rect.height/2 + window.scrollY;
            // 결과 텍스트
            resultLabel.textContent = resultTxt;
            resultLabel.classList.add("visible");
            pangPop.classList.add("visible");
            confettiBurst(centerX, centerY);
            // 2초 후 복구
            setTimeout(()=>{
              rollCapsule.style.display="none";
              resultLabel.classList.remove("visible");
              pangPop.classList.remove("visible");
              rollCapsule.className = "roll-capsule";
              capTop.className = "cap-top";
              isRolling = false;
            },1800);
          },900); // 열림+컨페티
        },820); // 중앙으로 이동 후 열림
      },140); // 레버 후 굴러나오게 딜레이
    });
  </script>
</body>
</html>
