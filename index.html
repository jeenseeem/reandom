<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>MTHD의 오늘의 메뉴 추천!</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0; padding: 0;
      background: radial-gradient(circle at 60% 20%, #faf7fd 0%, #f1eefe 60%, #ffe8fa 100%);
      font-family: 'Nanum Pen Script', 'Segoe UI', 'Malgun Gothic', cursive, sans-serif;
      box-sizing: border-box;
      overflow: hidden;
    }
    body {
      width: 100vw; height: 100vh;
      min-width: 320px;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      user-select: none;
      position: relative;
    }
    h1 {
      margin: 32px 0 14px 0;
      font-size: 3.3em;
      color: #920056;
      letter-spacing: 3.5px;
      font-weight: 700;
      text-align: center;
      line-height: 1.1;
      text-shadow: 0 5px 25px #f8b1f74f, 0 2px 6px #c098bb3a;
      user-select: none;
      z-index: 20;
      position: relative;
      font-family: 'Nanum Pen Script', cursive, sans-serif;
    }
    .setting {
      width: 350px; max-width: 96vw;
      background: #fff8;
      border-radius: 12px;
      box-shadow: 0 2px 14px #e6b1e955;
      margin: 12px 0 3px 0; padding: 16px 20px;
      display: flex; flex-direction: column; align-items: stretch; gap: 12px;
      z-index: 10;
      position: relative;
    }
    .setting label {
      font-size: 1.13em; color: #8f3572; font-weight: bold; margin-bottom: 7px;
      letter-spacing: 1.2px; font-family: 'Nanum Pen Script', cursive;
    }
    .setting textarea {
      width: 100%; min-height: 90px; padding: 8px 10px;
      font-size: 1.18em; border-radius: 9px; border: 2px solid #dea1e5;
      resize: vertical; outline: none; font-family: 'Nanum Pen Script', cursive, sans-serif;
      background: #f7f5fe;
      box-shadow: 0 1px 4px #ffe4f911;
    }
    .setting button {
      align-self: flex-end;
      font-size: 1.12em; color: #fff;
      background: linear-gradient(90deg, #cf50a7 70%, #957dcf 100%);
      border: none; border-radius: 7px; padding: 7px 18px 6px 18px;
      font-weight: bold; cursor: pointer; margin-top: 6px;
      font-family: 'Nanum Pen Script', cursive, sans-serif;
      box-shadow: 0 3px 12px #efb5c533;
      letter-spacing: 1.1px; transition: background .15s;
    }
    .setting button:active {background: linear-gradient(90deg, #942c80 70%, #544ba9 100%);}
    .notice {
      color: #8a2962; font-size: 1em; margin-bottom: 2px; text-align: right; font-family: 'Nanum Pen Script', cursive;
    }
    .word-cloud-bg {
      pointer-events: none;
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      z-index: 1;
      overflow: hidden;
    }
    .cloud-word {
      position: absolute;
      font-size: calc(22px + 2.9vw);
      font-weight: 700;
      color: #b38fe4b1;
      opacity: 0.19;
      letter-spacing: 2px;
      font-family: 'Nanum Pen Script', 'Segoe UI', 'Malgun Gothic', cursive, sans-serif;
      will-change: transform;
      user-select: none;
      white-space: pre;
      transition: opacity 0.2s, color 0.2s, transform 0.13s cubic-bezier(.52,1.7,.71,1.23);
    }
    .cloud-word.near {
      opacity: 0.78;
      color: #8f4ad8e2;
    }
    .gacha-area {
      position: relative;
      width: 355px; max-width: 97vw;
      height: 455px; max-height: 56vh;
      margin: 22px 0 18px 0;
      min-width: 190px;
      z-index: 6;
      display: flex; align-items: center; justify-content: center;
    }
    .gacha-machine {
      position: absolute;
      left: 50%; top: 0; transform: translateX(-50%);
      width: 245px; height: 440px;
      z-index: 10;
      user-select: none;
      pointer-events: none;
    }
    .gacha-body {
      position: absolute; bottom: 0; left: 50%;
      transform: translateX(-50%);
      width: 150px; height: 100px;
      background: linear-gradient(0deg,#d82d47 60%,#a11836 100%);
      border: 4px solid #b18bc7;
      border-radius: 18px 18px 20px 20px/23px 23px 30px 33px;
      box-shadow: 0 10px 32px #d5567399;
      z-index: 12;
    }
    .gacha-window {
      position: absolute; top: 0; left: 50%;
      transform: translateX(-50%);
      width: 155px; height: 190px;
      background: linear-gradient(180deg,#fff7ff 60%,#e7f0ff 100%);
      border: 4px solid #b18bc7;
      border-bottom: none;
      border-radius: 23px 23px 52px 52px/31px 31px 100px 100px;
      overflow: hidden;
      z-index: 15;
      display: flex; flex-wrap: wrap; align-items: flex-end; justify-content: center; padding-bottom: 12px;
    }
    .capsule{
      width:31px;height:30px;margin:2px;margin-top:7px;border-radius:50%;
      background: radial-gradient(circle at 15px 7px,var(--cap1,#ecd),var(--cap2,#bfb));
      border: 1.8px solid #8a72a8; box-shadow: 0 2px 7px #c58ca644;
    }
    .capsule:nth-child(1){--cap1:#fec;--cap2:#fcc;}
    .capsule:nth-child(2){--cap1:#9fd;--cap2:#3df;}
    .capsule:nth-child(3){--cap1:#cbe;--cap2:#f9f;}
    .capsule:nth-child(4){--cap1:#ff5;--cap2:#fc0;}
    .capsule:nth-child(5){--cap1:#9ff;--cap2:#7cf;}
    .capsule:nth-child(6){--cap1:#fda;--cap2:#fd8;}
    .capsule:nth-child(7){--cap1:#fdc;--cap2:#fac;}
    .capsule:nth-child(8){--cap1:#acf;--cap2:#bfe;}
    .capsule:nth-child(9){--cap1:#f8f;--cap2:#c8f;}
    .gacha-lever {
      position: absolute; 
      left: 50%; bottom: 70px;
      transform: translateX(-50%);
      z-index: 16;
      width: 58px; height: 58px;
      border-radius: 50%;
      background: linear-gradient(160deg,#eee,#bbb 70%);
      border: 3.2px solid #888;
      box-shadow: 0 4px 12px #ad2d5319;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: box-shadow .12s;
      pointer-events: auto;
    }
    .gacha-lever:active,.lever-spin{box-shadow:0 2px 24px #83005a90;animation:leverAnime .69s cubic-bezier(.61,2,.27,1) 1;}
    @keyframes leverAnime{0%{transform:translateX(-50%) rotate(0);}15%{transform:translateX(-50%) rotate(-36deg);}53%{transform:translateX(-50%) rotate(57deg);}100%{transform:translateX(-50%) rotate(0);}}
    .lever-dot{width:30px;height:30px;background:radial-gradient(circle at 75% 22%,#f25 70%,#8b1 100%);border-radius:50%;border:2px solid #ab2828;box-shadow:0 1px 6px #e8939b;}
    .gacha-door{position:absolute;left:69%;bottom:8px;width:33px;height:28px;background:linear-gradient(140deg,#fff 80%,#eee 95%);border:2.4px solid #acacac;border-radius:9px 10px 5px 12px/11px 20px 14px 11px;box-shadow:0 0 8px #bbb6;z-index:32;}
    .roll-capsule {
      --ball1: #ffadad; --ball2: #ffd6a5;
      position: absolute; left: 72.5%; bottom: 85px;
      width: 34px; height: 34px; z-index: 201;
      pointer-events: none;
      border-radius: 50%; background: radial-gradient(circle at 11px 6px, var(--ball1), var(--ball2));
      border: 2.2px solid #ae93b7;
      box-shadow: 0 1px 7px #e4568348;
      opacity: 0;
      display: flex; align-items: center; justify-content: center;
      transition: none;
    }
    .roll-capsule.rolling {
      opacity: 1;
      animation: roll-from-window 0.77s cubic-bezier(.4,2.2,.5,1.02) 0s 1 forwards;
    }
    @keyframes roll-from-window {
      0% { left: 54%; bottom: 140px; transform: scale(.68) rotate(-30deg);}
      60% { left: 72.5%; bottom: 98px; transform: scale(1.09) rotate(20deg);}
      90% { left: 72.5%; bottom: 88px; transform: scale(1) rotate(1deg);}
      100%{ left: 72.5%; bottom: 85px; transform: scale(1) rotate(0);}
    }
    .roll-capsule.toward-center {
      animation: move-to-center 0.73s cubic-bezier(.39,2,.4,1.08) 0s 1 forwards;
    }
    @keyframes move-to-center {
      0% { left: 72.5%; bottom: 85px; width: 34px; height: 34px;}
      100% { left: 50%; bottom: 54%; width: 310px; height: 137px; transform: translate(-50%,50%) rotate(0);}
    }
    .confetti {
      position: fixed;
      width: 18px; height: 26px;
      border-radius: 6px;
      z-index: 5000;
      opacity: 0.94;
      pointer-events: none;
      mix-blend-mode: multiply;
    }
    .super-result {
      position: fixed;
      left: 50%; top: 53%;
      transform: translate(-50%, -50%) scale(1);
      font-size: clamp(3em,13vw,7.5em);
      color: #222;
      font-weight: 900;
      text-shadow: 2.5px 3.5px 0 #fff,0 7px 40px #fff8, 0 0 0 #fff;
      letter-spacing: 9px;
      line-height: 1.12;
      pointer-events: none;
      opacity: 0;
      z-index: 9001;
      white-space: pre-line;
      transition: opacity .18s, filter 0.09s;
      font-family: 'Nanum Pen Script', cursive, sans-serif;
      user-select: none;
      text-align: center;
    }
    .super-result.visible {
      opacity: 1;
      animation: pop-fade-sup 0.7s cubic-bezier(.36,2.2,.6,1.05) .04s 1 backwards;
    }
    @keyframes pop-fade-sup {
      0% {filter:blur(15px) brightness(1.5) contrast(8);}
      40% {filter:blur(3px);}
      100%{filter:none;}
    }
    .bandai {
      position: fixed;
      right: 12px; bottom: 8px;
      font-family: 'Arial Black', Arial, sans-serif;
      color: #fff; background: #cf234a;
      padding: 3px 19px 3px 16px;
      border-radius: 15px 9px 15px 20px/20px;
      font-size: 1.14em;
      letter-spacing: 0.19em;
      z-index: 10000;
      box-shadow: 0 4px 18px #a8333a2a;
      opacity: 0.93;
      font-weight: 900;
      user-select: none;
    }
    @media (max-width:860px) {
      .super-result {font-size: clamp(2.4em, 9vw, 5em);}
    }
  </style>
  <body>
    <div class="word-cloud-bg" id="cloudBg"></div>
    <h1>MTHD의<br>오늘의 메뉴 추천 !</h1>
    <div class="setting">
      <label for="itemlist">뽑기 리스트 (한 줄에 하나씩 입력):</label>
      <textarea id="itemlist" placeholder="예시&#10;쌀국수&#10;짬뽕&짜장"></textarea>
      <button id="saveBtn">저장하기</button>
      <div class="notice">저장하면 사이트를 다시 열어도 유지돼요!</div>
    </div>
    <div class="gacha-area" id="gachaArea">
      <div class="gacha-machine" id="gachaMachine">
        <div class="gacha-window">
          <div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div>
        </div>
        <div class="gacha-lever" id="lever" title="손잡이를 돌려 뽑기!">
          <div class="lever-dot"></div>
        </div>
        <div class="gacha-body"></div>
        <div class="gacha-door"></div>
      </div>
      <div class="roll-capsule" id="rollCapsule" style="display:none;"></div>
    </div>
    <div class="super-result" id="superResult"></div>
    <div class="bandai">BANDAI</div>
    <script>
      // 저장 복원
      function renderCloudWords() {
        cloudBg.innerHTML = "";
        const raw = textarea.value.split('\n').map(t=>t.trim()).filter(Boolean);
        if (!raw.length) return;
        const W = window.innerWidth, H = window.innerHeight;
        let reps = Math.max(12, Math.floor(W*H/61000));
        let used = [];
        for (let r=0; r<reps; r++) for (let i=0; i<raw.length; i++)
          used.push(raw[i]);
        used.sort(() => Math.random() - .5);
        used = used.slice(0,Math.min(45+Math.floor(W/54),used.length));
        used.forEach(w => {
          let span = document.createElement('span');
          span.textContent = w;
          span.className = 'cloud-word';
          let px = Math.random(), py = Math.random();
          span.style.left = `calc(${(px*95)}vw)`;
          span.style.top = `calc(${Math.pow(py,1.1)*91}vh)`;
          let a = Math.round((Math.random()-0.5)*28);
          span.style.transform += ` rotate(${a}deg)`;
          cloudBg.appendChild(span);
        });
      }
      textarea.addEventListener('input', renderCloudWords);

      window.addEventListener('mousemove', e => {
        const words = document.querySelectorAll('.cloud-word');
        const mx = e.clientX, my = e.clientY;
        words.forEach(w=>{
          let rect = w.getBoundingClientRect(),
              wx = rect.left+rect.width/2, wy = rect.top+rect.height/2;
          let dx = wx-mx, dy = wy-my;
          let d = Math.sqrt(dx*dx + dy*dy);
          if (d < 140) {
            w.classList.add('near');
            let rep = Math.max(0, 140 - d);
            w.style.transform = w.style.transform.replace(/translate\([^\)]*\)/g,'') +
              ` translate(${dx/35*rep}px,${dy/38*rep}px)`;
          } else {
            w.classList.remove('near');
            w.style.transform = w.style.transform.replace(/translate\([^\)]*\)/g,'');
          }
        });
      });
      window.addEventListener('resize', renderCloudWords);

      // 최초 클라우드!
      window.addEventListener('DOMContentLoaded', ()=>{
        loadList();
        renderCloudWords();
      });

      // 애니+컨페티+캡슐/글자
      const lever = document.getElementById('lever');
      const rollCapsule = document.getElementById('rollCapsule');
      const superResult = document.getElementById('superResult');
      const gachaMachine = document.getElementById('gachaMachine');
      let isRolling = false;

      function confettiBurst(centerX, centerY) {
        const colors = [
          "#fff275","#ff6150","#6469f9","#3ad29f","#fec0fa",
          "#a1f7ff","#feaeae","#5bf45b","#ffdca6","#c17aff"
        ];
        let confs = [];
        for (let i = 0; i < 52; i++) {
          let conf = document.createElement('div');
          conf.className = 'confetti';
          let angle = Math.random() * Math.PI * 2;
          let dist = 120 + Math.random() * 190;
          let s = 0.85 + Math.random()*1.15;
          conf.style.background = colors[Math.floor(Math.random()*colors.length)];
          conf.style.left = (centerX-11) + "px";
          conf.style.top = (centerY-8) + "px";
          conf.style.transform = `rotate(${Math.random()*360}deg) scale(${s})`;
          conf.animate([
            { opacity: 0.98, transform: `translate(0,0) scale(${s}) rotate(${Math.random()*360}deg)` },
            { opacity: 1, offset: 0.11 },
            {
              opacity: 0.91,
              transform: `translate(${Math.cos(angle)*dist}px,${Math.sin(angle)*dist}px) scale(${s}) rotate(${Math.random()>.5?240:390}deg)`
            },
            {
              opacity: 0,
              transform: `translate(${Math.cos(angle)*dist*1.19}px,${Math.sin(angle)*dist*1.19}px) scale(${s}) rotate(${Math.random()>.5?120:520}deg)`
            }
          ],{ duration: 1200 + Math.random()*550, easing: 'cubic-bezier(.45,.8,.18,1)', fill:'forwards' });
          document.body.appendChild(conf);
          confs.push(conf);
        }
        setTimeout(()=>confs.forEach(c=>c.remove()),2400);
      }

      lever.addEventListener('click', () => {
        if (isRolling) return;
        const items = textarea.value.split('\n').map(e=>e.trim()).filter(e=>e.length>0);
        if (items.length < 1) {
          alert("뽑기 리스트를 입력 후 저장해주세요!");
          return;
        }
        isRolling = true;

        lever.classList.add('lever-spin');
        setTimeout(() => lever.classList.remove('lever-spin'), 700);

        // 초기화
        rollCapsule.style.display = "none";
        rollCapsule.className = "roll-capsule";
        rollCapsule.innerHTML = "";
        superResult.classList.remove('visible');
        superResult.textContent = "";

        // 결과, 색상
        const idx = Math.floor(Math.random()*items.length);
        const resultTxt = items[idx];
        let ballcolors = [
          ["#ffadad","#ffd6a5"],["#caffbf","#9bf6ff"],
          ["#bdb2ff","#ffc6ff"],["#fcf6bd","#fdffb6"],
          ["#a0c4ff","#bdb2ff"],["#f1c0e8","#e2f0cb"]
        ];
        let bc = ballcolors[Math.floor(Math.random()*ballcolors.length)];

        // -- 캡슐 굴러오기 애니 --
        rollCapsule.style.background = `radial-gradient(circle at 11px 6px, ${bc[0]}, ${bc[1]})`;
        rollCapsule.style.border = "2.2px solid #ae93b7";
        rollCapsule.style.display = "flex";
        setTimeout(()=>{
          rollCapsule.className = "roll-capsule rolling";
          setTimeout(()=>{
            rollCapsule.className += " toward-center";
            setTimeout(()=>{
              // 캡슐 사라짐, 결과 글자 드러남
              rollCapsule.style.display = "none";
              rollCapsule.className = "roll-capsule";
              rollCapsule.innerHTML = "";
              // 중간 위치에서 컨페티
              let rect = gachaMachine.getBoundingClientRect();
              let cx = rect.left + rect.width/2;
              let cy = rect.top + rect.height*0.62;
              superResult.textContent = resultTxt;
              superResult.classList.add('visible');
              confettiBurst(cx, cy);

              setTimeout(()=>{
                superResult.classList.remove('visible');
                superResult.textContent = "";
                isRolling = false;
              }, 1800);
            },680); // 캡슐 -> 중간 대기, 바로 사라짐
          },700); // 중앙 이동
        },140); // 레버 후 굴러나오기
      });
    </script>
  </body>
</html>
