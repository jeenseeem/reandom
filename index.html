<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>MTHD의 오늘의 메뉴 추천!</title>
  <style>
    html, body {
      height: 100%; margin: 0; padding: 0;
      background: #fcf7ff;
      font-family: 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
      box-sizing: border-box; overflow: hidden;
    }
    body {
      min-width: 320px;
      width: 100vw; height: 100vh;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      user-select: none;
      position: relative;
    }
    h1 {
      margin-top: 30px; margin-bottom: 12px;
      font-size: 2.7em;
      font-weight: 900;
      color: #6e167c;
      letter-spacing: 2.5px;
      z-index: 10; position: relative;
      text-align: center;
    }
    .setting {
      width: 335px; max-width: 96vw; z-index:10;
      background: #fffdfbcc;
      border-radius: 12px;
      box-shadow: 0 2px 16px #e0ccf733;
      padding: 16px 18px;
      display: flex; flex-direction: column; gap: 11px;
      align-items: stretch;
    }
    .setting label { font-weight: 700; margin-bottom: 5px; }
    .setting textarea {
      font-size: 1.04em; border: 2px solid #dab7ee;
      border-radius: 7px;
      padding: 7px; min-height: 55px;
      resize: vertical; outline: none;
      background: #f8f4fa;
      font-family: 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
    }
    .setting button {
      align-self: flex-end;
      background: #ad61e0; color: #fff;
      border: none; border-radius: 7px;
      font-size: 1em; padding: 5px 19px;
      font-weight: 700; cursor: pointer;
      letter-spacing:0.7px;
      transition: background .15s;
    }
    .setting button:active { background:#7a3ea6; }
    .notice {
      font-size: 0.96em; color: #6f5082; text-align: right;
    }
    .cloud-bg {
      pointer-events: none;
      position: fixed; left:0;top:0; width:100vw; height:100vh; z-index:0;
      overflow:hidden;
    }
    .cloud-word {
      position: absolute;
      font-size: clamp(2.2vw, 2.8vw, 48px);
      font-weight: 800;
      color: #c7a8e9;
      opacity: 0.14;
      letter-spacing: 2.5px;
      font-family: 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
      will-change: transform;
      user-select: none;
      white-space: pre;
      transition: opacity 0.22s, color 0.17s, transform 0.12s;
    }
    .cloud-word.near {
      opacity: 0.50;
      color: #9250c7;
    }

    .gacha-area {
      position: relative;
      width: 320px; max-width: 94vw; min-width:180px;
      height: 420px; max-height: 56vh; z-index:6;
      display: flex; align-items: center; justify-content: center;
    }
    .gacha-machine {
      position: absolute; left: 50%; top: 0; transform: translateX(-50%);
      width: 232px; height: 370px;
      z-index: 20; user-select:none; pointer-events:none;
    }
    .window {
      position: absolute; top:0;left:50%;transform:translateX(-50%);
      width:135px;height:120px; background: #fff;
      border: 3.5px solid #caaaf6; border-bottom: none;
      border-radius: 17px 17px 38px 38px / 22px 22px 65px 65px;
      z-index:21;
      overflow: hidden; display: flex; flex-wrap:wrap; align-items: flex-end; justify-content: center; padding-bottom:7px;
    }
    .capsule {
      width:28px;height:27px;margin:2px;
      border-radius:50%;
      background: radial-gradient(circle at 15px 7px,var(--cap1,#ecd),var(--cap2,#bfb));
      border: 1.2px solid #8a72a8; box-shadow: 0 1.3px 5px #c58ca644;
    }
    .capsule:nth-child(1){--cap1:#fec;--cap2:#fcc;}
    .capsule:nth-child(2){--cap1:#9fd;--cap2:#3df;}
    .capsule:nth-child(3){--cap1:#cbe;--cap2:#f9f;}
    .capsule:nth-child(4){--cap1:#ff5;--cap2:#fc0;}
    .capsule:nth-child(5){--cap1:#9ff;--cap2:#7cf;}
    .capsule:nth-child(6){--cap1:#fda;--cap2:#fd8;}
    .capsule:nth-child(7){--cap1:#fdc;--cap2:#fac;}
    .capsule:nth-child(8){--cap1:#acf;--cap2:#bfe;}
    .body {
      position:absolute;bottom:0;left:50%;transform:translateX(-50%);
      width:130px;height:84px; background:linear-gradient(0deg,#df61c1 60%,#a35cbc 100%);
      border: 4px solid #caaaf6; border-radius:15px 15px 22px 22px/25px 25px 20px 28px;
      box-shadow:0 7px 30px #9d5abe1c; z-index:22;
    }
    .lever {
      position:absolute; left:50%; bottom:64px; transform:translateX(-50%);
      width:44px;height:44px;z-index:30; border-radius:50%;
      background:linear-gradient(130deg,#e3deee 74%,#a291c0 100%);
      border:2.2px solid #9b7aba; display:flex;align-items:center;justify-content:center;
      cursor:pointer; transition: box-shadow .11s; pointer-events:auto;
    }
    .lever:active, .lever-spin{box-shadow:0 2px 24px #9600785c;animation:leverAnime .61s cubic-bezier(.61,2,.27,1) 1;}
    @keyframes leverAnime{0%{transform:translateX(-50%) rotate(0);}15%{transform:translateX(-50%) rotate(-29deg);}53%{transform:translateX(-50%) rotate(46deg);}100%{transform:translateX(-50%) rotate(0);}}
    .lever-dot { width:22px;height:22px;background:radial-gradient(circle at 60% 25%,#d772f2 70%,#b21c90 100%); border-radius:50%;border:1.3px solid #971a93;box-shadow:0 1px 3px #e896e6;}
    .door {position:absolute;left:67%;bottom:4px;width:16px;height:16px; background:linear-gradient(140deg,#fff 80%,#eee 95%);border:1.7px solid #acacac;border-radius:9px;box-shadow:0 0 4px #bbb5;z-index:32;}

    .animated-capsule {
      position: absolute;
      left: 72%; bottom: 90px; width: 36px; height: 36px;
      border-radius: 50%;
      background: radial-gradient(circle at 13px 5px, #eeb, #e8acf1);
      border: 2.1px solid #ae93b7; opacity: 0; z-index:300;
      box-shadow: 0 2px 5px #c381d155;
      transition: none;
      display: flex; align-items: center; justify-content: center;
    }
    .animated-capsule.rolling {
      opacity: 1;
      animation: roll-capsule-entry 0.7s cubic-bezier(.4,2.2,.55,1.08) 0s 1 forwards;
    }
    @keyframes roll-capsule-entry {
      0% { left: 50%; bottom: 140px; transform: scale(.8) rotate(-28deg);}
      65% { left: 72%; bottom: 98px; transform: scale(1.09) rotate(16deg);}
      100%{ left: 72%; bottom: 90px; transform: scale(1) rotate(0);}
    }
    .animated-capsule.toward-center {
      animation: move-capsule-center 0.64s cubic-bezier(.39,2,.4,1.08) 0s 1 forwards;
    }
    @keyframes move-capsule-center {
      0% { left: 72%; bottom: 90px; width: 36px; height: 36px;}
      100% { left: 50%; bottom: 52%; width: 340px; height: 100px; transform: translate(-50%,50%) rotate(0);}
    }
    .confetti {
      position: fixed;
      width: 17px; height: 23px;
      border-radius: 6px;
      z-index: 1000;
      opacity: 0.95;
      pointer-events: none;
      mix-blend-mode: multiply;
    }
    .super-result {
      position: fixed;
      left: 50%; top: 53%;
      transform: translate(-50%, -50%) scale(1);
      font-size: clamp(2.2em, 13vw, 8.7em);
      color: #222;
      font-weight: 900;
      text-shadow: 2.5px 6.5px 0 #fff,0 2px 10px #fff8, 0 0 0 #fff;
      letter-spacing: 10px;
      line-height: 1.12;
      pointer-events: none;
      opacity: 0;
      z-index: 2000;
      white-space: pre-line;
      transition: opacity .21s, filter 0.12s;
      font-family: 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
      user-select: none;
      text-align: center;
    }
    .super-result.visible {
      opacity: 1;
      animation: pop-result-fade 0.58s cubic-bezier(.36,2.2,.6,1) .04s 1 backwards;
    }
    @keyframes pop-result-fade {
      0% {filter:blur(13px) brightness(1.6) contrast(7);}
      60% { filter:blur(2px);}
      100%{filter:none;}
    }
    .bandai {
      position: fixed;
      right: 12px; bottom: 8px;
      font-family: 'Arial Black', Arial, sans-serif;
      color: #fff; background: #cf234a;
      padding: 3px 19px 3px 16px;
      border-radius: 15px 9px 15px 20px/20px;
      font-size: 1.14em;
      letter-spacing: 0.19em;
      z-index: 10000;
      box-shadow: 0 4px 18px #a8333a2a;
      opacity: 0.93;
      font-weight: 900;
      user-select: none;
    }
  </style>
  <body>
    <div class="cloud-bg" id="cloudBg"></div>
    <h1>MTHD의<br>오늘의 메뉴 추천 !</h1>
    <div class="setting">
      <label for="itemlist">뽑기 리스트 (한 줄에 하나씩 입력):</label>
      <textarea id="itemlist" placeholder="예시&#10;쌀국수&#10;짬뽕&짜장"></textarea>
      <button id="saveBtn">저장하기</button>
      <div class="notice">저장하면 사이트를 다시 열어도 유지돼요!</div>
    </div>
    <div class="gacha-area">
      <div class="gacha-machine">
        <div class="window">
          <div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div>
          <div class="capsule"></div><div class="capsule"></div>
        </div>
        <div class="body"></div>
        <div class="lever" id="lever" title="손잡이를 돌려 뽑기!">
          <div class="lever-dot"></div>
        </div>
        <div class="door"></div>
      </div>
      <div class="animated-capsule" id="animCapsule"></div>
    </div>
    <div class="super-result" id="superResult"></div>
    <div class="bandai">BANDAI</div>
    <script>
      // 저장, 복원
      const STORAGE_KEY = "__gacha_items_v5__";
      const textarea = document.getElementById('itemlist');
      const saveBtn = document.getElementById('saveBtn');
      const cloudBg = document.getElementById('cloudBg');

      function saveList() {
        localStorage.setItem(STORAGE_KEY, textarea.value);
      }
      function loadList() {
        const saved = localStorage.getItem(STORAGE_KEY);
        textarea.value = saved ? saved : "";
      }
      saveBtn.addEventListener('click', () => {
        saveList();
        saveBtn.textContent = '저장됨!';
        setTimeout(() => { saveBtn.textContent = '저장하기'; }, 1000);
        renderCloudWords();
      });

      // 배경 단어 클라우드
      function renderCloudWords() {
        cloudBg.innerHTML = "";
        const raw = textarea.value.split('\n').map(t=>t.trim()).filter(Boolean);
        if (!raw.length) return;
        const W = window.innerWidth, H = window.innerHeight;
        let reps = Math.max(10, Math.floor(W*H/76000));
        let used = [];
        for (let r=0; r<reps; r++) for (let i=0; i<raw.length; i++)
          used.push(raw[i]);
        used.sort(() => Math.random() - .5);
        used = used.slice(0,Math.min(48+Math.floor(W/61),used.length));
        used.forEach(w => {
          let span = document.createElement('span');
          span.textContent = w;
          span.className = 'cloud-word';
          let px = Math.random(), py = Math.random();
          span.style.left = `calc(${(px*96)}vw)`;
          span.style.top = `calc(${Math.pow(py,1.1)*91}vh)`;
          let a = Math.round((Math.random()-0.5)*24);
          span.style.transform += ` rotate(${a}deg)`;
          cloudBg.appendChild(span);
        });
      }
      textarea.addEventListener('input', renderCloudWords);
      window.addEventListener('resize', renderCloudWords);

      window.addEventListener('DOMContentLoaded', ()=>{
        loadList();
        renderCloudWords();
      });

      window.addEventListener('mousemove', e => {
        const words = document.querySelectorAll('.cloud-word');
        const mx = e.clientX, my = e.clientY;
        words.forEach(w=>{
          let rect = w.getBoundingClientRect(),
              wx = rect.left+rect.width/2, wy = rect.top+rect.height/2;
          let dx = wx-mx, dy = wy-my;
          let d = Math.sqrt(dx*dx + dy*dy);
          if (d < 120) {
            w.classList.add('near');
            let rep = Math.max(0, 120 - d);
            w.style.transform = w.style.transform.replace(/translate\([^\)]*\)/g,'')
              + ` translate(${dx/32*rep}px,${dy/34*rep}px)`;
          } else {
            w.classList.remove('near');
            w.style.transform = w.style.transform.replace(/translate\([^\)]*\)/g,'');
          }
        });
      });

      // 가챠 동작
      const lever = document.getElementById('lever');
      const animCapsule = document.getElementById('animCapsule');
      const superResult = document.getElementById('superResult');
      let isRolling = false;

      function confettiBurst(centerX, centerY) {
        const colors = [
          "#fff275","#ff6150","#6469f9","#3ad29f","#fec0fa",
          "#a1f7ff","#feaeae","#5bf45b","#ffdca6","#c17aff"
        ];
        let confs = [];
        for (let i = 0; i < 38; i++) {
          let conf = document.createElement('div');
          conf.className = 'confetti';
          let angle = Math.random() * Math.PI * 2;
          let dist = 120 + Math.random() * 160;
          let s = 0.8 + Math.random() * 1.06;
          conf.style.background = colors[Math.floor(Math.random() * colors.length)];
          conf.style.left = (centerX-8) + "px";
          conf.style.top = (centerY-10) + "px";
          conf.style.transform = `rotate(${Math.random()*360}deg) scale(${s})`;
          conf.animate([
            { opacity: 0.98, transform: `translate(0,0) scale(${s}) rotate(${Math.random()*360}deg)` },
            { opacity: 1, offset: 0.13 },
            {
              opacity: 0.91,
              transform: `translate(${Math.cos(angle)*dist}px,${Math.sin(angle)*dist}px) scale(${s}) rotate(${Math.random()>.5?240:390}deg)`
            },
            {
              opacity: 0,
              transform: `translate(${Math.cos(angle)*dist*1.19}px,${Math.sin(angle)*dist*1.19}px) scale(${s}) rotate(${Math.random()>.5?120:520}deg)`
            }
          ],{ duration: 1200 + Math.random()*450, easing: 'cubic-bezier(.45,.8,.18,1)', fill:'forwards' });
          document.body.appendChild(conf);
          confs.push(conf);
        }
        setTimeout(()=>confs.forEach(c=>c.remove()),1800);
      }

      lever.addEventListener('click', () => {
        if (isRolling) return;
        const items = textarea.value.split('\n').map(e=>e.trim()).filter(e=>e.length>0);
        if (items.length < 1) {
          alert("뽑기 리스트를 입력 후 저장해주세요!");
          return;
        }
        isRolling = true;

        lever.classList.add('lever-spin');
        setTimeout(() => lever.classList.remove('lever-spin'), 600);

        // 초기화
        animCapsule.style.opacity = 0;
        animCapsule.className = "animated-capsule";
        superResult.classList.remove('visible');
        superResult.textContent = "";

        // 결과/색상
        const idx = Math.floor(Math.random()*items.length);
        const resultTxt = items[idx];
        let ballcolors = [
          ["#ffadad","#ffd6a5"],["#caffbf","#9bf6ff"],
          ["#bdb2ff","#ffc6ff"],["#fcf6bd","#fdffb6"],
          ["#a0c4ff","#bdb2ff"],["#f1c0e8","#e2f0cb"]
        ];
        let bc = ballcolors[Math.floor(Math.random()*ballcolors.length)];
        animCapsule.style.background = `radial-gradient(circle at 13px 5px, ${bc[0]}, ${bc[1]})`;
        animCapsule.style.border = "2.1px solid #ae93b7";
        animCapsule.style.opacity = 1;
        animCapsule.className = "animated-capsule rolling";

        setTimeout(()=> {
          animCapsule.className += " toward-center";
          // 중앙으로 이동 후 -> 캡슐 사라짐, 결과/컨페티!
          setTimeout(()=>{
            animCapsule.style.opacity = 0;
            // 결과 글자
            superResult.textContent = resultTxt;
            superResult.classList.add('visible');
            // 중앙좌표
            let rect = superResult.getBoundingClientRect();
            let cx = rect.left + rect.width/2;
            let cy = rect.top + rect.height/2;
            confettiBurst(cx, cy);
            setTimeout(()=>{
              superResult.classList.remove('visible');
              superResult.textContent = "";
              isRolling = false;
            }, 1700);
          }, 700);
        }, 680);
      });
    </script>
  </body>
</html>
